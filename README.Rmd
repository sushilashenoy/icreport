
The `icreport` package provides functions that perform independent component analysis on a given data set and can subsequently generate a compact report. 

## Quick Start

### Important Note

The report generating feature of this package requires a program called ```pandoc``` version 1.12.3 or higher to be installed. This is not a problem when you are using the most recent version of Rstudio (0.98.1102 at the moment - 2 March 2015), since it comes with the required ```pandoc``` functionality. However, if you are running ```icreport``` from good-old-fashioned-R you might run into an error message that pandoc is not installed. In such a case, please review the following link to install the correct version of pandoc on your machine. (https://github.com/rstudio/rmarkdown/blob/master/PANDOC.md)

### 1.Loading and Preparing an Example Dataset

If you already know what you want to use the package for, follow this simple example to get started!

1) The package is not yet published on bioconductor or CRAN, so the best way to install the package is directly from github. Installing the package through the function ```install_github``` from the package ```devtools```.

```{r Install icreport, eval = FALSE}
install.packages("devtools") # in case you don't have devtools already

devtools::install_github("jinhyunju/icreport") #installing icreport

```

2) Loading an example dataset

- Here we are going to use a public dataset that is available on the Gene Expression Omnibus (GEO).

- You can use your own dataset, it just needs to be a matrix which has the dimension of (gene x samples). A dataframe with covariate information is optional with dimensions (samples x covariates). 

- To generate the example dataset, all you have to do is source the script included in the package. 

- If you are interested in the details of the script you can check the path to the script by printing out the value that is saved in the ```example.data.script``` object and open it up in any text editor. 

- Please be aware that the script will install two packages ```GEOquery``` and ```biomaRt``` if you don't already have it on your machine. 

```{r Install datasets, message = FALSE, warning=FALSE, cache = TRUE}
example.data.script <- system.file("templates/create_example_data.R", package="icreport")

source(example.data.script)
```

```{r setseed, echo = FALSE}
set.seed(7777777)
setwd("~/Dropbox/ICA_organized_workspace/")
```

- This will take a few minutes depending on your internet connection, since it is downloading data from GEO and biomaRt. 

- If everything ran correctly, it will generate 3 objects, ```expr.data```, ```sample.info```, and ```probe.info```.

- ```expr.data``` = gene expression measurements for 26383 probes and 47 samples. 

- ```sample.info``` = 5 covariates for each sample 

- ```probe.info``` = positional information for 26828 probes
  
  
- Onething that you have to watch out for is that the rownames of ```sample.info``` have to match the column names of the ```expr.data```. They don't necessarily have to be in the same order but they should have names that overlap. 


### 2.Running ICA on the expression dataset. 

2-1) Things that you need:

- phenotype.mx should be the expression matrix with genes in rows and samples in columns (dimension = genes x samples)

- info.df should be the sample information data frame with the covariates in columns (dimension = samples x covariates)

- check.covars should be a vector that contains the names of the covariates (column names of sample.info) that should be tested for associations with independent components. In this case we are testing all 5 covariates for associations.

- For information regarding other advanced options please use ```?gene_expr_ica```.

2-2) In case you have covariates:

```{r ICA w covars, message = FALSE, warning=FALSE}
library(icreport)
ica_result <- gene_expr_ica(phenotype.mx = expr.data, 
                            info.df = sample.info,
                            check.covars = colnames(sample.info))

# This may also take a few minutes depending on the size of your dataset. 
```

2-3) In case you don't have any covariates:

```{r ICA wo covars, eval = FALSE}
library(icreport)
ica_result <- gene_expr_ica(phenotype.mx = expr)

```

2-4) Creating a report file in the current working directory

- input should be the result generated by the ```gene_expr_ica()``` function.

- prefix specifies the name of the html report file. 

- geneinfo.df should be a dataframe that contains information about gene (or probe) positions. The column names should be "phenotype" for the genes or probes (rownames of expr.data), "pheno_chr" for chromosomes, "pheno_start" for starting coordinates and "pheno_end" for end coordinates. See example below for more details. 

```{r geneinfo example, comment = NA}

head(probe.info)

```

- You can specify the output directory by including the option output.path = "/path/to/directory". Please note that sometimes directories starting with the short cut for home "~" are not recognized, so I recommend setting the working directory to the desired output directory first or specifying the full path. 

```{r ICA report, eval = FALSE, message = FALSE, warning=FALSE}
report2me(input = ica_result, 
          prefix = "Test_ICA_Report",
          geneinfo.df = probe.info)
```

### 3.Running PCA on the expression dataset. 

The PCA functionality of the package runs ```prcomp()``` on the dataset, and also tests given covariates against the principal components.

3-1) In case you have covariates:

```{r PCA w covars, eval = TRUE, message = FALSE, warning=FALSE}

pca_result <- gene_expr_pca(phenotype.mx = expr.data, 
                            info.df = sample.info,
                            check.covars = colnames(sample.info))

```

3-2) In case you don't have any covariates:

```{r PCA wo covars, eval = FALSE}

pca_result <- gene_expr_pca(phenotype.mx = expr.data)

```

3-3) Generating a report:

- report2me automatically detects whether the inputs are ICA or PCA results and it will generate the correct report. 

- pca.result is the result generated by the ```gene_expr_pca()``` function.

- prefix specifies the name of the html report file. 

```{r PCA report, eval = FALSE, message = FALSE, warning=FALSE}
report2me(input = pca_result, 
          prefix = "Test_PCA_Report",
          geneinfo.df = probe.info)
```


### Interpreting Outputs

- Before we describe what each plot in the output report means, let us briefly review the model of ICA. 

1. ICA decomposes the observed dataset $\mathbf{Y}$ into $k$ independent components and their corresponding coefficients. 

$$ \mathbf{Y} = \mathbf{A}\mathbf{S} $$

where $\mathbf{Y}$ is the N x g observed data matrix, $\mathbf{A}$ is the N x k coefficient matrix (also known as the mixing matrix), and $\mathbf{S}$ is the k x g independent component matrix. 


Special Thanks to: Sushila, Francisco, Monica, Priya, Adrian, and Jason B. for testing and feedback. 
